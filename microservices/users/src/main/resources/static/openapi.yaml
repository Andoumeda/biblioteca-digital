openapi: 3.0.1
info:
  title: Biblioteca Digital API
  version: v1.0
  description: API Documentation for Biblioteca Digital - Módulo de Usuarios

servers:
  - url: http://localhost:8080
    description: API Gateway
  - url: http://localhost:8081
    description: Módulo de Perfiles de usuarios

tags:
  - name: User Profiles
    description: Gestión de perfiles de usuario
  - name: ProfileAnnouncements
    description: Gestión de la relación entre perfiles y anuncios
  - name: Announcements
    description: Gestión de anuncios

security:
  - bearerAuth: []

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Autenticación mediante JWT token. Incluir el token en el header Authorization como 'Bearer {token}'

paths:
  # USER PROFILE ENDPOINTS
  /user-profiles:
    post:
      tags:
        - User Profiles
      summary: Crear nuevo perfil de usuario
      operationId: createUserProfile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './models/openapi.yaml#/components/schemas/UserProfileRequestDTO'
      responses:
        '201':
          description: Perfil creado exitosamente
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/UserProfileResponseDTO'
  /user-profiles/{id}:
    get:
      tags:
        - User Profiles
      summary: Obtener perfil de usuario por ID
      operationId: getUserProfileById
      parameters:
        - name: id
          in: path
          required: true
          description: ID del perfil de usuario
          schema:
            type: integer
            format: int32
            example: 0
      responses:
        '200':
          description: Perfil encontrado
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/UserProfileResponseDTO'
    put:
      tags:
        - User Profiles
      summary: Actualizar perfil de usuario
      operationId: updateUserProfile
      parameters:
        - name: id
          in: path
          required: true
          description: ID del perfil de usuario
          schema:
            type: integer
            format: int32
            example: 0
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './models/openapi.yaml#/components/schemas/UserProfileRequestDTO'
      responses:
        '200':
          description: Perfil actualizado exitosamente
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/UserProfileResponseDTO'
    delete:
      tags:
        - User Profiles
      summary: Eliminar perfil de usuario
      operationId: deleteUserProfile
      parameters:
        - name: id
          in: path
          required: true
          description: ID del perfil de usuario
          schema:
            type: integer
            format: int32
            example: 0
      responses:
        '204':
          description: Perfil eliminado exitosamente

  /user-profiles/display-name/{displayName}/page/{page}:
    get:
      tags:
        - User Profiles
      summary: Listar perfiles por displayName paginado
      operationId: getUserProfilesByFilters
      parameters:
        - name: displayName
          in: path
          required: true
          description: Nombre a mostrar del perfil. Use '-' para omitir este filtro.
          schema:
            type: string
            example: '-'
        - name: page
          in: path
          required: true
          description: Número de página (comienza en 0)
          schema:
            type: integer
            format: int32
            example: 0
      responses:
        '200':
          description: Lista paginada de perfiles encontrada
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/PaginatedUserProfileResponseDTO'

  # ANNOUNCEMENT ENDPOINTS
  /announcements:
    post:
      tags:
        - Announcements
      summary: Crear nuevo anuncio
      operationId: createAnnouncement
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './models/openapi.yaml#/components/schemas/AnnouncementRequestDTO'
      responses:
        '201':
          description: Anuncio creado exitosamente
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/AnnouncementResponseDTO'

  /announcements/{id}:
    get:
      tags:
        - Announcements
      summary: Obtener anuncio por ID
      operationId: getAnnouncementById
      parameters:
        - name: id
          in: path
          required: true
          description: ID del anuncio
          schema:
            type: integer
            format: int32
            example: 0
      responses:
        '200':
          description: Anuncio encontrado
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/AnnouncementResponseDTO'
    put:
      tags:
        - Announcements
      summary: Actualizar anuncio
      operationId: updateAnnouncement
      parameters:
        - name: id
          in: path
          required: true
          description: ID del anuncio
          schema:
            type: integer
            format: int32
            example: 0
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './models/openapi.yaml#/components/schemas/AnnouncementRequestDTO'
      responses:
        '200':
          description: Anuncio actualizado exitosamente
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/AnnouncementResponseDTO'
    delete:
      tags:
        - Announcements
      summary: Eliminar anuncio
      operationId: deleteAnnouncement
      parameters:
        - name: id
          in: path
          required: true
          description: ID del anuncio
          schema:
            type: integer
            format: int32
            example: 0
      responses:
        '204':
          description: Anuncio eliminado

  /announcements/audience/{targetAudience}/type/{type}/page/{page}:
    get:
      tags:
        - Announcements
      summary: Listar anuncios por tipo paginado
      operationId: getAnnouncementsByFilters
      parameters:
        - name: targetAudience
          in: path
          required: true
          description: Audiencia objetivo del anuncio. Use '-' para omitir este filtro.
          schema:
            type: string
            enum:
             - ALL
             - NEW_USERS
             - ADMINS
             - '-'
            example: '-'
        - name: type
          in: path
          required: true
          description: Tipo de anuncio. Use '-' para omitir este filtro.
          schema:
            type: string
            enum:
             - ALERT
             - INFO
             - WARNING
             - PROMO
             - '-'
            example: '-'
        - name: page
          in: path
          required: true
          description: Número de página (comienza en 0)
          schema:
            type: integer
            format: int32
            example: 0
      responses:
        '200':
          description: Lista paginada de anuncios del tipo especificado
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/PaginatedAnnouncementResponseDTO'

  # PROFILE-ANNOUNCEMENTS ENDPOINTS
  /profile-announcements:
    post:
      tags:
        - ProfileAnnouncements
      summary: Crear relación perfil-anuncio
      operationId: createProfileAnnouncement
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './models/openapi.yaml#/components/schemas/ProfileAnnouncementRequestDTO'
      responses:
        '201':
          description: Relaciones perfil-anuncio creadas
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/ProfileAnnouncementResponseDTO'

  /profile-announcements/{id}:
    get:
      tags:
        - ProfileAnnouncements
      summary: Obtener relación perfil-anuncio por ID
      operationId: getProfileAnnouncementById
      parameters:
        - name: id
          in: path
          required: true
          description: ID de la relación perfil-anuncio
          schema:
            type: integer
            format: int32
            example: 0
      responses:
        '200':
          description: Relación encontrada
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/ProfileAnnouncementResponseDTO'
    put:
      tags:
        - ProfileAnnouncements
      summary: Actualizar relación perfil-anuncio
      operationId: updateProfileAnnouncement
      parameters:
        - name: id
          in: path
          required: true
          description: ID de la relación perfil-anuncio
          schema:
            type: integer
            format: int32
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './models/openapi.yaml#/components/schemas/UpdateProfileAnnouncementRequestDTO'
      responses:
        '200':
          description: Relación actualizada exitosamente
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/ProfileAnnouncementResponseDTO'
    delete:
      tags:
        - ProfileAnnouncements
      summary: Eliminar relación perfil-anuncio
      operationId: deleteProfileAnnouncement
      parameters:
        - name: id
          in: path
          required: true
          description: ID de la relación perfil-anuncio
          schema:
            type: integer
            format: int32
            example: 0
      responses:
        '204':
          description: Relación eliminada

  /profile-announcements/profile/{profileId}/announcement/{announcementId}/date/{min}/{max}/isRead/{isRead}/page/{page}:
    get:
      tags:
        - ProfileAnnouncements
      summary: Listar relaciones perfil-anuncio por filtros paginado
      description: Busca relaciones perfil-anuncio aplicando filtros opcionales
      operationId: getProfileAnnouncementsByFilters
      parameters:
        - name: profileId
          in: path
          required: true
          description: ID del perfil. Use 0 para omitir este filtro.
          schema:
            type: integer
            format: int32
            example: 0
        - name: announcementId
          in: path
          required: true
          description: ID del anuncio. Use 0 para omitir este filtro.
          schema:
            type: integer
            format: int32
            example: 0
        - name: min
          in: path
          required: true
          description: Fecha mínima de relación en formato ISO 8601 (AAAA-MM-DDTHH:MM:SS). Use "0000-01-01T00:00:00Z" para omitir este filtro.
          schema:
            type: string
            format: date-time
            example: "0000-01-01T00:00:00Z"
        - name: max
          in: path
          required: true
          description: Fecha máxima de relación en formato ISO 8601 (AAAA-MM-DDTHH:MM:SSZ). Use "0000-01-01T00:00:00Z" para omitir este filtro.
          schema:
            type: string
            format: date-time
            example: "0000-01-01T00:00:00Z"
        - name: isRead
          in: path
          required: true
          description: Estado de lectura. Use 'true', 'false' o '-' para omitir este filtro.
          schema:
            type: string
            enum: ['true', 'false', '-']
            example: '-'
        - name: page
          in: path
          required: true
          description: Número de página (comienza en 0)
          schema:
            type: integer
            format: int32
            example: 0
      responses:
        '200':
          description: Lista paginada de relaciones perfil-anuncio filtradas
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/PaginatedProfileAnnouncementResponseDTO'
