openapi: 3.0.1
info:
  title: Biblioteca Digital API
  version: v1.0
  description: API Documentation for Biblioteca Digital

servers:
  - url: http://localhost:8083
    description: Módulo de Libros

tags:
  - name: Books
    description: Gestión de libros
  - name: Authors
    description: Gestión de autores
  - name: Ratings
    description: Gestión de valoraciones

# security:
  # - bearerAuth: []

paths:
  # ===========================
  # BOOKS
  # ===========================
  /books:
    post:
      tags: [Books]
      summary: Crear libro
      operationId: createBook
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './models/openapi.yaml#/components/schemas/BookRequestDTO'
      responses:
        '201':
          description: Libro creado
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/BookResponseDTO'

  /books/page/{page}:
    get:
      tags: [Books]
      summary: Obtener todos los libros
      operationId: getAllBooks
      parameters:
        - name: page
          in: path
          required: true
          schema:
            type: integer
            format: int32
      responses:
        '200':
          description: Lista de libros
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/PaginatedBookResponseDTO'

  /books/title/{title}/page/{page}:
    get:
      tags: [Books]
      summary: Obtener libros por título
      operationId: getBooksByTitle
      parameters:
        - name: title
          in: path
          required: true
          schema:
            type: string
        - name: page
          in: path
          required: true
          schema:
            type: integer
            format: int32
      responses:
        '200':
          description: Lista de libros filtrados por título
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/PaginatedBookResponseDTO'

  /books/publication/{publicationId}/page/{page}:
    get:
      tags: [Books]
      summary: Obtener libros de una publicación
      operationId: getBooksByPublicationId
      parameters:
        - name: publicationId
          in: path
          required: true
          schema:
            type: integer
            format: int32
          description: ID de la publicación
        - name: page
          in: path
          required: true
          schema:
            type: integer
            format: int32
      responses:
        '200':
          description: Lista de libros de una publicación
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/PaginatedBookResponseDTO'

  /books/author/{id}/page/{page}:
    get:
      tags: [Books]
      summary: Obtener los libros de un autor
      operationId: getBooksByAuthorId
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int32
        - name: page
          in: path
          required: true
          schema:
            type: integer
            format: int32
      responses:
        '200':
          description: Lista de libros de un autor
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/PaginatedBookResponseDTO'

  /books/{id}:
    get:
      tags: [Books]
      summary: Obtener libro por ID
      operationId: getBookById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int32
      responses:
        '200':
          description: Libro encontrado
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/BookResponseDTO'
    put:
      tags: [Books]
      summary: Actualizar libro
      operationId: updateBook
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int32
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './models/openapi.yaml#/components/schemas/BookRequestDTO'
      responses:
        '200':
          description: Libro actualizado
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/BookResponseDTO'
    delete:
      tags: [Books]
      summary: Eliminar libro (soft delete)
      operationId: deleteBook
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int32
      responses:
        '204':
          description: Libro marcado como eliminado

  # ===========================
  # AUTHORS
  # ===========================
  /authors:
    post:
      tags: [Authors]
      summary: Crear autor
      operationId: createAuthor
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './models/openapi.yaml#/components/schemas/AuthorRequestDTO'
      responses:
        '201':
          description: Autor creado
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/AuthorResponseDTO'

  /authors/book/{bookId}/fullname/{fullname}/birthdate/{min}/{max}/nationality/{nationality}/page/{page}:
    get:
      tags: [Authors]
      summary: Obtener autores con manejo de filtros opcionales
      description: Busca autores aplicando filtros opcionales
      operationId: getAuthorsByFilters
      parameters:
        - name: bookId
          in: path
          required: true
          description: ID del libro. Use 0 para omitir este filtro
          schema:
            type: integer
            format: int32
          example: '0'
        - name: fullname
          in: path
          required: true
          description: Nombre completo del autor (búsqueda parcial). Use "-" para omitir este filtro
          schema:
            type: string
          example: '-'
        - name: min
          in: path
          required: true
          description: Fecha mínima de nacimiento en formato AAAA-MM-DD. Use "0000-01-01" para omitir este filtro
          schema:
            type: string
            format: date
          example: '0000-01-01'
        - name: max
          in: path
          required: true
          description: Fecha máxima de nacimiento en formato AAAA-MM-DD. Use "0000-01-01" para omitir este filtro
          schema:
            type: string
            format: date
          example: '0000-01-01'
        - name: nationality
          in: path
          required: true
          description: Nacionalidad del autor (búsqueda parcial). Use "-" para omitir este filtro
          schema:
            type: string
          example: '-'
        - name: page
          in: path
          required: true
          description: Número de página (comienza en 0)
          schema:
            type: integer
            format: int32
          example: '0'
      responses:
        '200':
          description: Lista paginada de autores que cumplen los filtros
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/PaginatedAuthorResponseDTO'

  /authors/{id}:
    get:
      tags: [Authors]
      summary: Obtener autor por ID
      operationId: getAuthorById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int32
      responses:
        '200':
          description: Autor encontrado
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/AuthorResponseDTO'
    put:
      tags: [Authors]
      summary: Actualizar autor
      operationId: updateAuthor
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int32
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './models/openapi.yaml#/components/schemas/AuthorRequestDTO'
            example:
              fullName: "Miguel de Cervantes Saavedra"
              bio: "Escritor español, autor de 'Don Quijote'. Nació en Alcalá de Henares."
              birthDate: "1547-09-29"
              nationality: "Española"
      responses:
        '200':
          description: Autor actualizado
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/AuthorResponseDTO'
    delete:
      tags: [Authors]
      summary: Eliminar autor (soft delete)
      operationId: deleteAuthor
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int32
      responses:
        '204':
          description: Autor marcado como eliminado

  # ===========================
  # RATINGS
  # ===========================
  /ratings:
    post:
      tags: [Ratings]
      summary: Crear valoración
      operationId: createRating
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './models/openapi.yaml#/components/schemas/RatingRequestDTO'
      responses:
        '201':
          description: Valoración creada
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/RatingResponseDTO'

  /ratings/page/{page}:
    get:
      tags: [Ratings]
      summary: Obtener todas las valoraciones
      operationId: getAllRatings
      parameters:
        - name: page
          in: path
          required: true
          schema:
            type: integer
            format: int32
      responses:
        '200':
          description: Lista de valoraciones
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/PaginatedRatingResponseDTO'

  /ratings/valoration/{min}/{max}/page/{page}:
    get:
      tags: [Ratings]
      summary: Obtener valoraciones por rango de puntuación
      operationId: getRatingsByScoreRange
      parameters:
        - name: min
          in: path
          required: true
          schema:
            type: integer
        - name: max
          in: path
          required: true
          schema:
            type: integer
        - name: page
          in: path
          required: true
          schema:
            type: integer
            format: int32
      responses:
        '200':
          description: Valoraciones filtradas por puntuación
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/PaginatedRatingResponseDTO'

  /ratings/userprofile/{userProfileId}/page/{page}:
    get:
      tags: [Ratings]
      summary: Obtener valoraciones de un usuario
      operationId: getRatingsByUserProfileId
      parameters:
        - name: userProfileId
          in: path
          required: true
          schema:
            type: integer
            format: int32
        - name: page
          in: path
          required: true
          schema:
            type: integer
            format: int32
      responses:
        '200':
          description: Lista de valoraciones de un usuario
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/PaginatedRatingResponseDTO'

  /ratings/book/{id}/page/{page}:
    get:
      tags: [Ratings]
      summary: Obtener valoraciones de un libro
      operationId: getRatingsByBookId
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int32
        - name: page
          in: path
          required: true
          schema:
            type: integer
            format: int32
      responses:
        '200':
          description: Lista de valoraciones de un libro
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/PaginatedRatingResponseDTO'

  /ratings/{id}:
    get:
      tags: [Ratings]
      summary: Obtener valoración por ID
      operationId: getRatingById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int32
      responses:
        '200':
          description: Valoración encontrada
          content:
            application/json:
              schema:
                $ref: './models/openapi.yaml#/components/schemas/RatingResponseDTO'
    put:
      tags: [Ratings]
      summary: Actualizar valoración
      operationId: updateRating
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int32
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              description: RatingRequestDTO
      responses:
        '200':
          description: Valoración actualizada
          content:
            application/json:
              schema:
                type: object
                description: RatingResponseDTO
    delete:
      tags: [Ratings]
      summary: Eliminar valoración (soft delete)
      operationId: deleteRating
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int32
      responses:
        '204':
          description: Valoración marcada como eliminada
